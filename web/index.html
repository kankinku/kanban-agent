<!doctype html>
<html lang="ko" data-theme="light">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kanban SSOT Dashboard</title>
  <link rel="stylesheet" as="style" crossorigin
    href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
  <style>
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg-main: #f2f4f6;
      --bg-card: #ffffff;
      --bg-sidebar: #ffffff;
      --bg-header: rgba(255, 255, 255, 0.88);
      --border: #e5e8eb;
      --text-primary: #191f28;
      --text-secondary: #4e5968;
      --text-tertiary: #8b95a1;
      --brand: #3182f6;
      --brand-bg: #e8f3ff;
      --brand-hover: #1b64da;
      --green: #37c87c;
      --green-bg: rgba(55, 200, 124, .12);
      --red: #f04452;
      --red-bg: rgba(240, 68, 82, .12);
      --yellow: #f5b102;
      --yellow-bg: rgba(245, 177, 2, .12);
      --orange: #ff8a3d;
      --orange-bg: rgba(255, 138, 61, .12);
      --purple: #7c3aed;
      --purple-bg: rgba(124, 58, 237, .12);
      --cyan: #06b6d4;
      --cyan-bg: rgba(6, 182, 212, .12);
      --r-lg: 20px;
      --r-md: 14px;
      --r-sm: 10px;
      --r-xs: 7px;
      --sh: 0 2px 12px rgba(0, 0, 0, .04);
      --sh-md: 0 8px 28px rgba(0, 0, 0, .08);
      --t: all 0.2s ease;
    }

    [data-theme="dark"] {
      --bg-main: #111111;
      --bg-card: #1c1c1c;
      --bg-sidebar: #181818;
      --bg-header: rgba(24, 24, 24, .92);
      --border: #2a2a2a;
      --text-primary: #f1f3f5;
      --text-secondary: #a8b0bb;
      --text-tertiary: #636d79;
      --brand: #5096fa;
      --brand-bg: rgba(80, 150, 250, .14);
      --brand-hover: #6aa5fb;
      --green: #3dcb82;
      --green-bg: rgba(61, 203, 130, .12);
      --red: #f16672;
      --red-bg: rgba(241, 102, 114, .12);
      --yellow: #f7c325;
      --yellow-bg: rgba(247, 195, 37, .12);
      --sh: 0 4px 16px rgba(0, 0, 0, .25);
      --sh-md: 0 12px 40px rgba(0, 0, 0, .45);
    }

    html,
    body {
      height: 100%;
    }

    body {
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg-main);
      color: var(--text-primary);
      display: flex;
      letter-spacing: -0.01em;
      transition: background .3s, color .3s;
    }

    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 3px;
    }

    /* â”€â”€â”€ Sidebar â”€â”€â”€ */
    aside {
      width: 220px;
      flex-shrink: 0;
      background: var(--bg-sidebar);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      position: sticky;
      top: 0;
      height: 100vh;
      transition: background .3s, border-color .3s;
    }

    .logo {
      padding: 22px 20px 18px;
    }

    .logo h1 {
      font-size: 18px;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 9px;
    }

    .logo h1 .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--brand);
    }

    .logo span {
      font-size: 12px;
      color: var(--text-tertiary);
      margin-top: 3px;
      display: block;
    }

    nav {
      flex: 1;
      padding: 8px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: var(--r-sm);
      cursor: pointer;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
      transition: var(--t);
      margin-bottom: 2px;
    }

    .nav-item:hover {
      background: var(--bg-main);
      color: var(--text-primary);
    }

    .nav-item.active {
      background: var(--brand-bg);
      color: var(--brand);
    }

    .nav-item svg {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
    }

    .sidebar-footer {
      padding: 16px 18px;
      border-top: 1px solid var(--border);
    }

    .srv-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--green);
      display: inline-block;
    }

    .srv-dot.off {
      background: var(--red);
    }

    #srvLabel {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-tertiary);
      margin-left: 7px;
    }

    /* â”€â”€â”€ Main â”€â”€â”€ */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      overflow: hidden;
    }

    /* â”€â”€â”€ Topbar â”€â”€â”€ */
    .topbar {
      height: 60px;
      padding: 0 28px;
      background: var(--bg-header);
      backdrop-filter: blur(14px);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 80;
      transition: background .3s, border-color .3s;
    }

    .topbar h2 {
      font-size: 17px;
      font-weight: 700;
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .orch-badge {
      font-size: 12px;
      font-weight: 700;
      padding: 5px 12px;
      border-radius: 20px;
      background: var(--green-bg);
      color: var(--green);
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .orch-badge.paused {
      background: var(--yellow-bg);
      color: var(--yellow);
    }

    .orch-badge::before {
      content: '';
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: currentColor;
    }

    /* â”€â”€â”€ Buttons â”€â”€â”€ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 9px 15px;
      border-radius: var(--r-sm);
      border: 1px solid var(--border);
      background: var(--bg-card);
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: var(--t);
    }

    .btn:hover {
      background: var(--bg-main);
      color: var(--text-primary);
    }

    .btn:active {
      transform: scale(0.97);
    }

    .btn svg {
      width: 16px;
      height: 16px;
    }

    .btn-primary {
      background: var(--brand);
      color: #fff;
      border: none;
    }

    .btn-primary:hover {
      background: var(--brand-hover);
      color: #fff;
    }

    .btn-success {
      background: var(--green);
      color: #fff;
      border: none;
    }

    .btn-success:hover {
      filter: brightness(0.9);
    }

    .btn-danger {
      background: var(--red-bg);
      color: var(--red);
      border: none;
    }

    .btn-danger:hover {
      background: var(--red);
      color: #fff;
    }

    .btn-sm {
      padding: 6px 11px;
      font-size: 12px;
    }

    .btn-icon {
      padding: 8px;
      border-radius: 50%;
      width: 38px;
      height: 38px;
      border: none;
      background: transparent;
      box-shadow: none;
      color: var(--text-secondary);
    }

    .btn-icon:hover {
      background: var(--bg-main);
    }

    /* â”€â”€â”€ Content â”€â”€â”€ */
    .content {
      padding: 24px 28px;
      flex: 1;
      overflow-y: auto;
    }

    .view {
      display: none;
    }

    .view.active {
      display: block;
    }

    /* â”€â”€â”€ Stats row â”€â”€â”€ */
    .stats {
      display: flex;
      gap: 14px;
      margin-bottom: 24px;
    }

    .stat {
      flex: 1;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--r-lg);
      padding: 20px 22px;
      box-shadow: var(--sh);
    }

    .stat-label {
      font-size: 12px;
      color: var(--text-tertiary);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: .4px;
    }

    .stat-val {
      font-size: 30px;
      font-weight: 800;
      margin-top: 6px;
    }

    /* â”€â”€â”€ Board â”€â”€â”€ */
    .board {
      display: flex;
      gap: 16px;
      overflow-x: auto;
      align-items: flex-start;
      padding-bottom: 8px;
    }

    .col {
      flex: 0 0 280px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--r-lg);
      box-shadow: var(--sh);
      display: flex;
      flex-direction: column;
      max-height: calc(100vh - 330px);
    }

    .col-head {
      padding: 16px 18px 14px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .col-dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: var(--text-tertiary);
      flex-shrink: 0;
    }

    .col[data-s="Ready"] .col-dot {
      background: var(--brand);
    }

    .col[data-s="InProgress"] .col-dot {
      background: var(--yellow);
    }

    .col[data-s="InReview"] .col-dot {
      background: var(--orange);
    }

    .col[data-s="Blocked"] .col-dot {
      background: var(--red);
    }

    .col[data-s="Done"] .col-dot {
      background: var(--green);
    }

    .col-title {
      font-size: 13px;
      font-weight: 700;
      flex: 1;
    }

    .col-cnt {
      font-size: 12px;
      font-weight: 600;
      background: var(--bg-main);
      color: var(--text-tertiary);
      padding: 2px 9px;
      border-radius: 12px;
    }

    .col-body {
      padding: 12px;
      overflow-y: auto;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    /* â”€â”€â”€ Task Card â”€â”€â”€ */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--r-md);
      padding: 14px 16px;
      cursor: pointer;
      transition: var(--t);
    }

    .card:hover {
      border-color: var(--brand);
      transform: translateY(-1px);
      box-shadow: var(--sh);
    }

    .card-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .card-id {
      font-size: 11px;
      font-weight: 700;
      color: var(--brand);
    }

    .p-badge {
      font-size: 10px;
      font-weight: 700;
      padding: 2px 7px;
      border-radius: 5px;
    }

    .p-high {
      background: var(--red-bg);
      color: var(--red);
    }

    .p-mid {
      background: var(--yellow-bg);
      color: var(--yellow);
    }

    .p-low {
      background: var(--green-bg);
      color: var(--green);
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
      line-height: 1.4;
      margin-bottom: 10px;
    }

    .card-meta {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      align-items: center;
    }

    .tag {
      font-size: 11px;
      font-weight: 600;
      padding: 3px 9px;
      border-radius: 6px;
      background: var(--bg-main);
      color: var(--text-secondary);
    }

    .tag-agent {
      background: var(--purple-bg);
      color: var(--purple);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .tag-review {
      background: var(--orange-bg);
      color: var(--orange);
    }

    .tag-done-r {
      background: var(--green-bg);
      color: var(--green);
    }

    /* â”€â”€â”€ Agent Panel (Board bottom) â”€â”€â”€ */
    .agent-section {
      margin-top: 28px;
    }

    .section-hd {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .section-hd h3 {
      font-size: 17px;
      font-weight: 700;
    }

    .agent-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 14px;
    }

    .agent-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--r-lg);
      padding: 18px 20px;
      box-shadow: var(--sh);
      transition: var(--t);
    }

    .agent-card:hover {
      border-color: var(--brand);
    }

    .agent-head {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .agent-avatar {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 800;
      flex-shrink: 0;
    }

    .role-worker {
      background: var(--brand-bg);
      color: var(--brand);
    }

    .role-reviewer {
      background: var(--yellow-bg);
      color: var(--yellow);
    }

    .role-manager {
      background: var(--green-bg);
      color: var(--green);
    }

    .agent-name {
      font-size: 15px;
      font-weight: 700;
    }

    .agent-role {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-tertiary);
      text-transform: uppercase;
      margin-top: 2px;
    }

    .agent-model {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 12px;
    }

    .agent-task {
      font-size: 12px;
      padding: 7px 10px;
      background: var(--bg-main);
      border-radius: var(--r-xs);
      color: var(--text-secondary);
      margin-bottom: 12px;
    }

    .agent-actions {
      display: flex;
      gap: 7px;
    }

    /* â”€â”€â”€ Provider Panel â”€â”€â”€ */
    .provider-list {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .prov-item {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--r-lg);
      padding: 20px 22px;
      margin-bottom: 14px;
      box-shadow: var(--sh);
    }

    .prov-head {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 14px;
    }

    .prov-icon {
      width: 46px;
      height: 46px;
      border-radius: var(--r-md);
      background: var(--bg-main);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 900;
      flex-shrink: 0;
    }

    .prov-info {
      flex: 1;
    }

    .prov-name {
      font-size: 16px;
      font-weight: 700;
    }

    .prov-desc {
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 3px;
    }

    .prov-badge {
      font-size: 12px;
      font-weight: 700;
      padding: 5px 14px;
      border-radius: 20px;
    }

    .prov-badge.ok {
      background: var(--green-bg);
      color: var(--green);
    }

    .prov-badge.no {
      background: var(--red-bg);
      color: var(--red);
    }

    .prov-body {
      background: var(--bg-main);
      border-radius: var(--r-sm);
      padding: 16px;
    }

    .prov-body .row {
      display: flex;
      gap: 10px;
    }

    .prov-note {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .prov-note code {
      background: var(--border);
      padding: 1px 6px;
      border-radius: 4px;
      font-family: monospace;
    }

    .prov-test-row {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-top: 10px;
    }

    /* â”€â”€â”€ Audit â”€â”€â”€ */
    .audit-item {
      display: flex;
      gap: 14px;
      padding: 14px 0;
      border-bottom: 1px solid var(--border);
    }

    .audit-item:last-child {
      border-bottom: none;
    }

    .audit-line {
      width: 3px;
      border-radius: 2px;
      background: var(--border);
      flex-shrink: 0;
      align-self: stretch;
    }

    .audit-action {
      font-size: 14px;
      font-weight: 700;
    }

    .audit-meta {
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 3px;
    }

    .audit-time {
      font-size: 11px;
      color: var(--text-tertiary);
      margin-top: 4px;
    }

    .audit-reason {
      margin-top: 8px;
      font-size: 12px;
      background: var(--bg-main);
      padding: 8px 12px;
      border-radius: var(--r-xs);
      color: var(--text-secondary);
    }

    /* â”€â”€â”€ Panels â”€â”€â”€ */
    .panel {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--r-lg);
      box-shadow: var(--sh);
      overflow: hidden;
    }

    .panel-head {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .panel-head h3 {
      font-size: 16px;
      font-weight: 700;
    }

    .panel-body {
      padding: 20px 24px;
      max-height: 600px;
      overflow-y: auto;
    }

    /* â”€â”€â”€ Form â”€â”€â”€ */
    .inp {
      width: 100%;
      padding: 11px 14px;
      border-radius: var(--r-sm);
      border: 1px solid var(--border);
      background: var(--bg-main);
      color: var(--text-primary);
      font-size: 14px;
      font-family: inherit;
      transition: var(--t);
    }

    .inp:focus {
      outline: none;
      border-color: var(--brand);
      background: var(--bg-card);
      box-shadow: 0 0 0 3px var(--brand-bg);
    }

    select.inp {
      cursor: pointer;
    }

    label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .form-row {
      display: flex;
      gap: 12px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex: 1;
      margin-bottom: 14px;
    }

    /* â”€â”€â”€ Modal â”€â”€â”€ */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .45);
      backdrop-filter: blur(8px);
      z-index: 200;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .overlay.show {
      display: flex;
    }

    .modal {
      background: var(--bg-card);
      width: 540px;
      max-width: 92vw;
      border-radius: var(--r-lg);
      box-shadow: var(--sh-md);
      display: flex;
      flex-direction: column;
      max-height: 88vh;
      animation: up .28s cubic-bezier(.16, 1, .3, 1);
    }

    @keyframes up {
      from {
        transform: translateY(24px);
        opacity: 0;
      }

      to {
        transform: none;
        opacity: 1;
      }
    }

    .modal-head {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-head h3 {
      font-size: 18px;
      font-weight: 700;
    }

    .modal-x {
      background: var(--bg-main);
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      color: var(--text-secondary);
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-x:hover {
      background: var(--border);
    }

    .modal-body {
      padding: 22px 24px;
      overflow-y: auto;
      flex: 1;
    }

    .modal-foot {
      padding: 16px 24px;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    /* â”€â”€â”€ Agent detail rows â”€â”€â”€ */
    .detail-row {
      display: flex;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }

    .detail-row:last-child {
      border-bottom: none;
    }

    .d-label {
      width: 130px;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-tertiary);
    }

    .d-val {
      flex: 1;
      font-size: 14px;
      line-height: 1.5;
    }

    .page-head {
      margin-bottom: 22px;
    }

    .page-head h2 {
      font-size: 22px;
      font-weight: 800;
    }

    .page-head p {
      font-size: 14px;
      color: var(--text-secondary);
      margin-top: 5px;
    }

    @media (max-width: 900px) {
      aside {
        width: 56px;
      }

      .logo h1 span.name,
      .logo span,
      .nav-item span {
        display: none;
      }

      .logo h1 {
        justify-content: center;
      }

      .nav-item {
        justify-content: center;
        padding: 12px;
      }

      .nav-item svg {
        margin: 0;
      }
    }

    /* â”€â”€â”€ Preset Cards (Agent Modal) â”€â”€â”€ */
    .preset-card {
      border: 2px solid var(--border);
      border-radius: var(--r-sm);
      padding: 12px 14px;
      cursor: pointer;
      transition: var(--t);
      background: var(--bg-main);
    }

    .preset-card:hover {
      border-color: var(--brand);
      background: var(--brand-bg);
    }

    .preset-card.selected {
      border-color: var(--brand);
      background: var(--brand-bg);
    }

    .preset-name {
      font-size: 13px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .preset-desc {
      font-size: 11px;
      color: var(--text-tertiary);
      margin-top: 3px;
    }

    /* â”€â”€â”€ Board empty state â”€â”€â”€ */
    .col-empty {
      text-align: center;
      padding: 32px 16px;
      color: var(--text-tertiary);
      font-size: 13px;
    }

    .col-empty svg {
      width: 32px;
      height: 32px;
      opacity: 0.3;
      margin-bottom: 8px;
    }

    /* â”€â”€â”€ Project Kickoff â”€â”€â”€ */
    .kickoff-banner {
      background: linear-gradient(135deg, var(--brand-bg), var(--bg-card));
      border: 1px solid var(--brand);
      border-radius: var(--r-lg);
      padding: 24px 28px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .kickoff-banner.hidden {
      display: none;
    }

    .kickoff-icon {
      font-size: 36px;
      flex-shrink: 0;
    }

    .kickoff-text h3 {
      font-size: 17px;
      font-weight: 700;
      color: var(--brand);
    }

    .kickoff-text p {
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    .kickoff-actions {
      margin-left: auto;
      display: flex;
      gap: 8px;
      flex-shrink: 0;
    }
  </style>
</head>

<body>

  <aside>
    <div class="logo">
      <h1><span class="dot"></span><span class="name">Kanban</span></h1>
      <span>Multi-Agent</span>
    </div>
    <nav>
      <div class="nav-item active" data-tab="board" onclick="go('board')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <rect x="3" y="3" width="7" height="7" rx="1" />
          <rect x="14" y="3" width="7" height="7" rx="1" />
          <rect x="3" y="14" width="7" height="7" rx="1" />
          <rect x="14" y="14" width="7" height="7" rx="1" />
        </svg>
        <span>ë³´ë“œ</span>
      </div>
      <div class="nav-item" data-tab="providers" onclick="go('providers')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
        </svg>
        <span>AI í”„ë¡œë°”ì´ë”</span>
      </div>
      <div class="nav-item" data-tab="audit" onclick="go('audit')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
        </svg>
        <span>ê°ì‚¬ ë¡œê·¸</span>
      </div>
    </nav>
    <div class="sidebar-footer">
      <span class="srv-dot" id="srvDot"></span><span id="srvLabel">ì—°ê²° ì¤‘...</span>
    </div>
  </aside>

  <div class="main">
    <header class="topbar">
      <h2 id="pageTitle">ë³´ë“œ</h2>
      <div class="topbar-right">
        <span class="orch-badge" id="orchBadge">Running</span>
        <button class="btn-icon btn" onclick="toggleTheme()" title="í…Œë§ˆ">
          <svg id="themeIco" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
          </svg>
        </button>
        <button class="btn" onclick="load()">ìƒˆë¡œê³ ì¹¨</button>
        <button class="btn btn-primary" onclick="showAddTask()">+ ì‘ì—…</button>
        <button class="btn btn-success" onclick="runOrch()">â–¶ 1íšŒ ì‹¤í–‰</button>
        <button class="btn" id="pauseBtn" onclick="togglePause()">â¸ ì¼ì‹œì •ì§€</button>
      </div>
    </header>

    <div class="content">

      <!-- Board -->
      <div class="view active" id="view-board">
        <!-- Project Kickoff Banner (shown when 0 tasks) -->
        <div class="kickoff-banner hidden" id="kickoffBanner">
          <div class="kickoff-icon">ğŸš€</div>
          <div class="kickoff-text">
            <h3>ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•´ë³¼ê¹Œìš”?</h3>
            <p>í”„ë¡œì íŠ¸ ì„¤ëª…ì„ ì…ë ¥í•˜ë©´ PM ì—ì´ì „íŠ¸ê°€ ì‘ì—…ì„ ë¶„í•´í•˜ê³  ë³´ë“œë¥¼ ì±„ì›Œë“œë¦½ë‹ˆë‹¤.</p>
          </div>
          <div class="kickoff-actions">
            <button class="btn btn-primary" onclick="openModal('kickoffModal')">ğŸ“‹ í”„ë¡œì íŠ¸ ì‹œì‘</button>
            <button class="btn" onclick="showAddTask()">+ ìˆ˜ë™ìœ¼ë¡œ ì‘ì—… ì¶”ê°€</button>
          </div>
        </div>
        <div class="stats" id="statsEl"></div>
        <div class="board" id="boardEl"></div>
        <!-- Agent panel -->
        <div class="agent-section">
          <div class="section-hd">
            <h3>ì—ì´ì „íŠ¸ íŒ€</h3>
            <button class="btn btn-primary btn-sm" onclick="openAgentModal()">+ ì—ì´ì „íŠ¸ ì¶”ê°€</button>
          </div>
          <div class="agent-grid" id="agentGrid"></div>
        </div>
      </div>

      <!-- Providers -->
      <div class="view" id="view-providers">
        <div class="page-head">
          <h2>AI í”„ë¡œë°”ì´ë” ì—°ë™</h2>
          <p>ê° LLM ì„œë¹„ìŠ¤ì˜ ì¸ì¦ ìƒíƒœë¥¼ í™•ì¸í•˜ê³  í˜ì´ì§€ì—ì„œ ë°”ë¡œ ì—°ê²°í•©ë‹ˆë‹¤.</p>
        </div>
        <div class="provider-list" id="provList"></div>
      </div>

      <!-- Audit -->
      <div class="view" id="view-audit">
        <div class="page-head">
          <h2>ì‹œìŠ¤í…œ ê°ì‚¬ ë¡œê·¸</h2>
          <p>ëª¨ë“  ìƒíƒœ ì „ì´ì™€ ì—ì´ì „íŠ¸ ê²°ì •ì´ ì˜êµ¬ ê¸°ë¡ë©ë‹ˆë‹¤.</p>
        </div>
        <div class="panel">
          <div class="panel-body" id="auditEl"></div>
        </div>
      </div>

    </div>
  </div>

  <!-- Task Modal -->
  <div class="overlay" id="taskModal" onclick="if(event.target===this)closeModal('taskModal')">
    <div class="modal">
      <div class="modal-head">
        <h3 id="taskModalTitle">ì‘ì—… ìƒì„¸</h3><button class="modal-x" onclick="closeModal('taskModal')">âœ•</button>
      </div>
      <div class="modal-body" id="taskModalBody"></div>
    </div>
  </div>

  <!-- Agent CRUD Modal -->
  <div class="overlay" id="agentModal" onclick="if(event.target===this)closeModal('agentModal')">
    <div class="modal">
      <div class="modal-head">
        <h3 id="agentModalTitle">ì—ì´ì „íŠ¸ ì¶”ê°€</h3>
        <button class="modal-x" onclick="closeModal('agentModal')">âœ•</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="agentId">
        <div class="form-group"><label>ì—ì´ì „íŠ¸ ì´ë¦„</label><input class="inp" id="agentName"
            placeholder="ì˜ˆ: feature-worker-02"></div>
        <div class="form-row">
          <div class="form-group">
            <label>ì—­í•  (Role)</label>
            <select class="inp" id="agentRole">
              <option value="worker">Worker (ì‹¤í–‰)</option>
              <option value="reviewer">Reviewer (í‰ê°€)</option>
              <option value="manager">Manager (ê²°ì •)</option>
            </select>
          </div>
          <div class="form-group">
            <label>ê¸°ë³¸ LLM ëª¨ë¸</label>
            <select class="inp" id="agentModel">
              <option value="">íŒ€ ì„œë¸Œì—ì´ì „íŠ¸ ì‚¬ìš©</option>
              <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
              <option value="gpt-4o-mini">GPT-4o Mini</option>
              <option value="gpt-4o">GPT-4o</option>
              <option value="codex">Codex CLI</option>
              <option value="copilot-gpt-4o">GitHub Copilot</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label>íŒ€ ì„œë¸Œì—ì´ì „íŠ¸ êµ¬ì„±</label>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:9px;margin-bottom:9px" id="teamPresets">
            <div class="preset-card"
              data-val='[{"role":"planner","provider":"gemini"},{"role":"coder","provider":"codex"},{"role":"qa","provider":"openai"}]'
              onclick="pickPreset(this)">
              <div class="preset-name">ğŸš€ í’€ìŠ¤íƒ íŒ€</div>
              <div class="preset-desc">Gemini ê¸°íš â†’ Codex êµ¬í˜„ â†’ GPT QA</div>
            </div>
            <div class="preset-card"
              data-val='[{"role":"researcher","provider":"gemini"},{"role":"writer","provider":"openai"}]'
              onclick="pickPreset(this)">
              <div class="preset-name">âœï¸ ë¬¸ì„œ/ë¦¬ì„œì¹˜ íŒ€</div>
              <div class="preset-desc">Gemini ì¡°ì‚¬ â†’ GPT ë¬¸ì„œ ì‘ì„±</div>
            </div>
            <div class="preset-card"
              data-val='[{"role":"coder","provider":"codex"},{"role":"reviewer","provider":"github-copilot"}]'
              onclick="pickPreset(this)">
              <div class="preset-name">ğŸ”§ ì½”ë“œ ë¦¬ë·° íŒ€</div>
              <div class="preset-desc">Codex êµ¬í˜„ â†’ Copilot ì½”ë“œë¦¬ë·°</div>
            </div>
            <div class="preset-card" data-val='[{"role":"solo","provider":"gemini"}]' onclick="pickPreset(this)">
              <div class="preset-name">ğŸ¤– ë‹¨ë… ì—ì´ì „íŠ¸</div>
              <div class="preset-desc">Gemini í•˜ë‚˜ë¡œ ëª¨ë“  ì‘ì—… ì²˜ë¦¬</div>
            </div>
          </div>
          <textarea class="inp" id="agentTeam" rows="2" placeholder="ìœ„ í”„ë¦¬ì…‹ ì„ íƒ ë˜ëŠ” ì§ì ‘ JSON ì…ë ¥"></textarea>
          <span style="font-size:11px;color:var(--text-tertiary);margin-top:4px">oh-my-codex agent-team êµ¬ì¡° Â· ì—­í• ë³„ ì„œë¸Œì—ì´ì „íŠ¸ë¥¼
            provider ê¸°ì¤€ìœ¼ë¡œ ë¶„í• ì •ë³µ</span>
        </div>
        <div class="form-group">
          <label>ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸</label>
          <textarea class="inp" id="agentPrompt" rows="3" placeholder="ì´ ì—ì´ì „íŠ¸ì˜ ì—­í• ê³¼ ëª©í‘œë¥¼ ì„œìˆ í•©ë‹ˆë‹¤."></textarea>
        </div>
      </div>
      <div class="modal-foot">
        <button class="btn btn-danger btn-sm" id="agentDeleteBtn" style="display:none;margin-right:auto"
          onclick="deleteAgent()">ì‚­ì œ</button>
        <button class="btn" onclick="closeModal('agentModal')">ì·¨ì†Œ</button>
        <button class="btn btn-primary" onclick="saveAgent()">ì €ì¥</button>
      </div>
    </div>
  </div>
  <!-- Kickoff Modal -->
  <div class="overlay" id="kickoffModal" onclick="if(event.target===this)closeModal('kickoffModal')">
    <div class="modal">
      <div class="modal-head">
        <h3>ğŸš€ ìƒˆ í”„ë¡œì íŠ¸ ì‹œì‘</h3>
        <button class="modal-x" onclick="closeModal('kickoffModal')">âœ•</button>
      </div>
      <div class="modal-body">
        <div
          style="background:var(--brand-bg);border-radius:var(--r-sm);padding:14px 16px;margin-bottom:18px;font-size:13px;color:var(--brand);font-weight:600;">
          PM ì—ì´ì „íŠ¸ê°€ ì„¤ëª…ì„ ì½ê³  ì‘ì—…(Task)ì„ ë¶„í•´í•˜ì—¬ Backlogì— ìë™ ë“±ë¡í•©ë‹ˆë‹¤.
        </div>
        <div class="form-group">
          <label>í”„ë¡œì íŠ¸ ì´ë¦„</label>
          <input class="inp" id="kickoffTitle" placeholder="ì˜ˆ: ì‡¼í•‘ëª° ë°±ì—”ë“œ API êµ¬ì¶•">
        </div>
        <div class="form-group">
          <label>í”„ë¡œì íŠ¸ ì„¤ëª… (ìƒì„¸í• ìˆ˜ë¡ ì¢‹ìŠµë‹ˆë‹¤)</label>
          <textarea class="inp" id="kickoffDesc" rows="6"
            placeholder="ì–´ë–¤ í”„ë¡œì íŠ¸ì¸ì§€, ì–´ë–¤ ê¸°ëŠ¥ì´ í•„ìš”í•œì§€, ê¸°ìˆ  ìŠ¤íƒ, ì œì•½ ì¡°ê±´ ë“±ì„ ììœ ë¡­ê²Œ ì„œìˆ í•˜ì„¸ìš”.&#10;&#10;ì˜ˆì‹œ:&#10;Node.js + SQLite ê¸°ë°˜ì˜ REST API ì„œë²„ë¥¼ êµ¬ì¶•í•©ë‹ˆë‹¤.&#10;ì¸ì¦(JWT), ìƒí’ˆ CRUD, ì£¼ë¬¸ ê´€ë¦¬, ê²°ì œ ì—°ë™(í¬íŠ¸ì›)ì´ í•„ìš”í•©ë‹ˆë‹¤.&#10;ë°°í¬ ëŒ€ìƒì€ Ubuntu 22.04 ì„œë²„ì…ë‹ˆë‹¤."></textarea>
        </div>
        <div class="form-group">
          <label>ì‘ì—… ë¶„í•´ ê¸°ì¡°</label>
          <select class="inp" id="kickoffPattern">
            <option value="sprint">ìŠ¤í”„ë¦°íŠ¸ ë‹¨ìœ„ (1~2ì£¼ ì‘ì—… ê¸°ì¤€)</option>
            <option value="feature">ê¸°ëŠ¥ ë‹¨ìœ„ (ê¸°ëŠ¥ë³„ ì„¸ë¶„í™”)</option>
            <option value="layer">ë ˆì´ì–´ ë‹¨ìœ„ (DB â†’ API â†’ UI ìˆœ)</option>
            <option value="mvp">MVP ìš°ì„  (í•µì‹¬ ê¸°ëŠ¥ë§Œ ë¨¼ì €)</option>
          </select>
        </div>
      </div>
      <div class="modal-foot">
        <button class="btn" onclick="closeModal('kickoffModal')">ì·¨ì†Œ</button>
        <button class="btn btn-primary" onclick="submitKickoff()">ğŸ¤– PMì—ê²Œ ë„˜ê¸°ê¸°</button>
      </div>
    </div>
  </div>

  <!-- Add Task Modal -->
  <div class="overlay" id="addTaskModal" onclick="if(event.target===this)closeModal('addTaskModal')">
    <div class="modal">
      <div class="modal-head">
        <h3>ìƒˆ ì‘ì—… ì¶”ê°€</h3><button class="modal-x" onclick="closeModal('addTaskModal')">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="form-group"><label>ì œëª©</label><input class="inp" id="taskTitle" placeholder="ì‘ì—… ì œëª©"></div>
        <div class="form-group"><label>ì„¤ëª…</label><textarea class="inp" id="taskDesc" rows="3"
            placeholder="ìƒì„¸ ë‚´ìš©"></textarea></div>
        <div class="form-row">
          <div class="form-group"><label>ìœ í˜•</label>
            <select class="inp" id="taskType">
              <option value="feature">Feature</option>
              <option value="bug">Bug</option>
              <option value="chore">Chore</option>
              <option value="research">Research</option>
            </select>
          </div>
          <div class="form-group"><label>ê¸´ê¸‰ë„ (1-5)</label><input class="inp" type="number" id="taskUrgency" min="1"
              max="5" value="3"></div>
          <div class="form-group"><label>ë‚œì´ë„ (1-5)</label><input class="inp" type="number" id="taskEffort" min="1"
              max="5" value="3"></div>
        </div>
        <div class="form-group"><label>í†µê³¼ ê¸°ì¤€ (ì¤„ êµ¬ë¶„)</label><textarea class="inp" id="taskAC" rows="3"
            placeholder="í•œ ì¤„ì— í•˜ë‚˜ì”© ê¸°ì¤€ì„ ì…ë ¥"></textarea></div>
      </div>
      <div class="modal-foot">
        <button class="btn" onclick="closeModal('addTaskModal')">ì·¨ì†Œ</button>
        <button class="btn btn-primary" onclick="submitTask()">ë“±ë¡</button>
      </div>
    </div>
  </div>

  <script>
    const API = 'http://localhost:4100';
    const STATUSES = ['Backlog', 'Ready', 'InProgress', 'InReview', 'Blocked', 'Done', 'Archived'];

    /* â”€â”€â”€ Theme â”€â”€â”€ */
    function toggleTheme() {
      const h = document.documentElement;
      const next = h.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      h.setAttribute('data-theme', next);
      localStorage.setItem('k-theme', next);
      const ico = document.getElementById('themeIco');
      ico.innerHTML = next === 'dark'
        ? '<circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>'
        : '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>';
    }
    (function init() {
      const t = localStorage.getItem('k-theme') || (matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', t);
      if (t === 'dark') { const ico = document.getElementById('themeIco'); ico.innerHTML = '<circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>'; }
    })();

    /* â”€â”€â”€ Nav â”€â”€â”€ */
    function go(tab) {
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      document.getElementById(`view-${tab}`).classList.add('active');
      document.querySelector(`.nav-item[data-tab="${tab}"]`).classList.add('active');
      const titles = { board: 'ë³´ë“œ', providers: 'AI í”„ë¡œë°”ì´ë” ì—°ë™', audit: 'ì‹œìŠ¤í…œ ê°ì‚¬ ë¡œê·¸' };
      document.getElementById('pageTitle').textContent = titles[tab] || '';
      if (tab === 'providers') loadProviders();
      if (tab === 'audit') loadAudit();
    }

    /* â”€â”€â”€ API â”€â”€â”€ */
    async function api(path, o = {}) {
      const r = await fetch(`${API}${path}`, o);
      return r.json();
    }

    /* â”€â”€â”€ Load all â”€â”€â”€ */
    let _tasks = [], _agents = [], _paused = false;
    async function load() {
      try {
        const [tasks, agents, orchSt, blocked] = await Promise.all([
          api('/api/tasks'), api('/api/agents'), api('/api/control/orchestrator'), api('/api/blockeds')
        ]);
        _tasks = tasks; _agents = agents; _paused = orchSt.orchestratorPaused;

        document.getElementById('srvDot').className = 'srv-dot';
        document.getElementById('srvLabel').textContent = 'API ì—°ê²°ë¨';

        const badge = document.getElementById('orchBadge');
        badge.className = `orch-badge${_paused ? ' paused' : ''}`;
        badge.textContent = _paused ? 'â¸ ì¼ì‹œì •ì§€' : 'â— Running';
        document.getElementById('pauseBtn').textContent = _paused ? 'â–¶ ì¬ê°œ' : 'â¸ ì¼ì‹œì •ì§€';

        renderStats(tasks, blocked);
        renderBoard(tasks);
        renderAgents(agents, tasks);
      } catch {
        document.getElementById('srvDot').className = 'srv-dot off';
        document.getElementById('srvLabel').textContent = 'ëŠê¹€';
      }
    }

    /* â”€â”€â”€ Stats â”€â”€â”€ */
    function renderStats(tasks, blocked) {
      const total = tasks.length;
      const done = tasks.filter(t => t.status === 'Done').length;
      const prog = tasks.filter(t => t.status === 'InProgress').length;
      const rev = tasks.filter(t => t.status === 'InReview').length;
      document.getElementById('statsEl').innerHTML = [
        ['ì „ì²´ ì‘ì—…', total, 'var(--brand)'],
        ['ì§„í–‰ ì¤‘', prog, 'var(--yellow)'],
        ['ë¦¬ë·° ì¤‘', rev, 'var(--orange)'],
        ['ì™„ë£Œ', done, 'var(--green)'],
        ['ì°¨ë‹¨', blocked.length, 'var(--red)'],
      ].map(([l, v, c]) => `<div class="stat"><div class="stat-label">${l}</div><div class="stat-val" style="color:${c}">${v}</div></div>`).join('');
    }

    /* â”€â”€â”€ Board â”€â”€â”€ */
    function renderBoard(tasks) {
      if (tasks.length === 0) {
        document.getElementById('kickoffBanner').classList.remove('hidden');
      } else {
        document.getElementById('kickoffBanner').classList.add('hidden');
      }

      const byS = Object.fromEntries(STATUSES.map(s => [s, []]));
      tasks.forEach(t => { if (byS[t.status]) byS[t.status].push(t); });
      document.getElementById('boardEl').innerHTML = STATUSES.map(s => {
        const cards = byS[s];
        const sorted = [...cards].sort((a, b) => Number(b.priorityScore || 0) - Number(a.priorityScore || 0));
        const bodyContent = sorted.length > 0
          ? sorted.map(t => cardHtml(t)).join('')
          : `<div class="col-empty"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="9" y1="3" x2="9" y2="21"/></svg><br/>ì‘ì—… ì—†ìŒ</div>`;
        return `<div class="col" data-s="${s}">
          <div class="col-head"><span class="col-dot"></span><span class="col-title">${s}</span><span class="col-cnt">${cards.length}</span></div>
          <div class="col-body">${bodyContent}</div>
        </div>`;
      }).join('');
    }

    function cardHtml(t) {
      const p = Number(t.priorityScore || 0);
      const pClass = p >= 20 ? 'p-high' : p >= 10 ? 'p-mid' : 'p-low';
      const pLabel = p >= 20 ? 'ê¸´ê¸‰' : p >= 10 ? 'ë³´í†µ' : 'ë‚®ìŒ';
      const reviewTag = t.status === 'InReview' ? `<span class="tag tag-review">ë¦¬ë·° ì¤‘</span>` : '';
      const doneTag = t.status === 'Done' ? `<span class="tag tag-done-r">ì™„ë£Œë¨</span>` : '';
      const agentTag = t.assigneeAgentId
        ? `<span class="tag tag-agent"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="7" r="4"/><path d="M5.5 21a8.38 8.38 0 0 1 13 0"/></svg>${t.assigneeAgentId}</span>` : '';
      return `<div class="card" onclick="showTask('${t.id}')">
    <div class="card-top">
      <span class="card-id">${t.id}</span>
      <span class="p-badge ${pClass}">${pLabel} P${p.toFixed(0)}</span>
    </div>
    <div class="card-title">${escHtml(t.title)}</div>
    <div class="card-meta">
      <span class="tag">${t.type}</span>
      ${agentTag}
      ${reviewTag}${doneTag}
      ${t.attemptCount > 0 ? `<span class="tag">${t.attemptCount}/${t.maxAttempt}íšŒ</span>` : ''}
    </div>
  </div>`;
    }

    /* â”€â”€â”€ Task detail â”€â”€â”€ */
    async function showTask(id) {
      const [t, arts, revs] = await Promise.all([api(`/api/tasks/${id}`), api(`/api/tasks/${id}/artifacts`), api(`/api/tasks/${id}/reviews`)]);
      document.getElementById('taskModalTitle').innerHTML = `<span style="color:var(--brand)">${t.id}</span>`;
      document.getElementById('taskModalBody').innerHTML = `
    <div style="font-size:19px;font-weight:700;margin-bottom:16px">${escHtml(t.title)}</div>
    <div class="detail-row"><div class="d-label">ìƒíƒœ</div><div class="d-val"><span class="tag">${t.status}</span></div></div>
    <div class="detail-row"><div class="d-label">ë‹´ë‹¹ ì—ì´ì „íŠ¸</div><div class="d-val">${t.assigneeAgentId || 'ë¯¸ë°°ì •'}</div></div>
    <div class="detail-row"><div class="d-label">ìš°ì„ ìˆœìœ„</div><div class="d-val">P${Number(t.priorityScore || 0).toFixed(1)}</div></div>
    <div class="detail-row"><div class="d-label">ì‹œë„ íšŸìˆ˜</div><div class="d-val">${t.attemptCount}/${t.maxAttempt}</div></div>
    <div class="detail-row"><div class="d-label">ì„¤ëª…</div><div class="d-val" style="background:var(--bg-main);padding:10px;border-radius:var(--r-xs);font-size:13px">${escHtml(t.description || 'ì—†ìŒ')}</div></div>
    <div class="detail-row"><div class="d-label">í†µê³¼ ê¸°ì¤€</div><div class="d-val">${(t.acceptanceCriteria || []).map(c => `<div style="display:flex;gap:7px;margin-bottom:5px"><span style="color:var(--brand)">âœ”</span>${escHtml(c)}</div>`).join('') || '-'}</div></div>
    <div class="detail-row"><div class="d-label">ì‚°ì¶œë¬¼ (${arts.length})</div><div class="d-val">${arts.map(a => `<div>â€¢ <strong>${a.kind}</strong> â€” ${escHtml(a.summary || '')}</div>`).join('') || 'ì—†ìŒ'}</div></div>
    <div class="detail-row"><div class="d-label">ë¦¬ë·° (${revs.length})</div><div class="d-val">${revs.map(r => `<div>â€¢ <strong style="color:${r.verdict === 'pass' ? 'var(--green)' : 'var(--red)'}">${r.verdict}</strong> â€” ${escHtml(r.comments || '')}</div>`).join('') || 'ì—†ìŒ'}</div></div>
  `;
      openModal('taskModal');
    }

    /* â”€â”€â”€ Agents â”€â”€â”€ */
    function renderAgents(agents, tasks) {
      document.getElementById('agentGrid').innerHTML = agents.map(a => {
        const myTask = tasks.find(t => t.assigneeAgentId === a.id && ['InProgress', 'InReview'].includes(t.status));
        const roleClass = `role-${a.role}`;
        const roleLabel = { worker: 'W', reviewer: 'R', manager: 'M' }[a.role] || '?';
        const taskInfo = myTask ? `<div class="agent-task">ğŸ”§ ${myTask.id}: ${escHtml(myTask.title)}</div>` : `<div class="agent-task" style="color:var(--text-tertiary)">â€” ëŒ€ê¸° ì¤‘</div>`;
        return `<div class="agent-card">
      <div class="agent-head">
        <div class="agent-avatar ${roleClass}">${roleLabel}</div>
        <div>
          <div class="agent-name">${escHtml(a.name)}</div>
          <div class="agent-role">${a.role}</div>
        </div>
      </div>
      <div class="agent-model">${a.model || 'íŒ€ ì„œë¸Œì—ì´ì „íŠ¸ êµ¬ì„±'}</div>
      ${taskInfo}
      <div class="agent-actions">
        <button class="btn btn-sm" onclick="openAgentModal(${JSON.stringify(a).replace(/"/g, '&quot;')})">í¸ì§‘</button>
      </div>
    </div>`;
      }).join('') + `<div class="agent-card" style="border:2px dashed var(--border);background:transparent;align-items:center;justify-content:center;cursor:pointer;display:flex;min-height:180px" onclick="openAgentModal()">
    <div style="text-align:center;color:var(--text-tertiary)">
      <div style="font-size:28px;margin-bottom:8px">+</div>
      <div style="font-size:13px;font-weight:600">ì—ì´ì „íŠ¸ ì¶”ê°€</div>
    </div>
  </div>`;
    }

    /* Agent modal */
    function openAgentModal(agent = null) {
      document.getElementById('agentId').value = agent?.id || '';
      document.getElementById('agentName').value = agent?.name || '';
      document.getElementById('agentRole').value = agent?.role || 'worker';
      document.getElementById('agentModel').value = agent?.model || '';
      document.getElementById('agentTeam').value = agent?.tool_scope || '';
      document.getElementById('agentPrompt').value = agent?.prompt || '';
      document.getElementById('agentModalTitle').textContent = agent ? `ì—ì´ì „íŠ¸ í¸ì§‘: ${agent.name}` : 'ì—ì´ì „íŠ¸ ì¶”ê°€';
      document.getElementById('agentDeleteBtn').style.display = agent ? 'inline-flex' : 'none';
      openModal('agentModal');
    }

    async function saveAgent() {
      const id = document.getElementById('agentId').value;
      const body = {
        name: document.getElementById('agentName').value,
        role: document.getElementById('agentRole').value,
        model: document.getElementById('agentModel').value || null,
        toolScope: document.getElementById('agentTeam').value || null,
        prompt: document.getElementById('agentPrompt').value || null,
        isActive: true
      };
      if (!body.name) return alert('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.');
      if (id) await api(`/api/agents/${id}`, { method: 'PUT', headers: { 'content-type': 'application/json' }, body: JSON.stringify(body) });
      else await api('/api/agents', { method: 'POST', headers: { 'content-type': 'application/json' }, body: JSON.stringify(body) });
      closeModal('agentModal');
      load();
    }

    async function deleteAgent() {
      const id = document.getElementById('agentId').value;
      if (!id || !confirm(`ì—ì´ì „íŠ¸ ${id}ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
      await api(`/api/agents/${id}`, { method: 'DELETE' });
      closeModal('agentModal');
      load();
    }

    /* â”€â”€â”€ Team Presets â”€â”€â”€ */
    function pickPreset(el) {
      document.querySelectorAll('.preset-card').forEach(c => c.classList.remove('selected'));
      el.classList.add('selected');
      const val = el.getAttribute('data-val');
      document.getElementById('agentTeam').value = JSON.stringify(JSON.parse(val), null, 2);
    }

    /* â”€â”€â”€ Project Kickoff â”€â”€â”€ */
    async function submitKickoff() {
      const title = document.getElementById('kickoffTitle').value.trim();
      const desc = document.getElementById('kickoffDesc').value.trim();
      const pattern = document.getElementById('kickoffPattern').value;
      if (!title || !desc) return alert('í”„ë¡œì íŠ¸ ì´ë¦„ê³¼ ì„¤ëª…ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');

      const fullDesc = `[ìƒˆ í”„ë¡œì íŠ¸ í‚¥ì˜¤í”„]\nì´ë¦„: ${title}\në¶„í•´ ê¸°ì¡°: ${pattern}\nìƒì„¸ ì„¤ëª…:\n${desc}`;

      try {
        await api('/api/tasks', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            title: `[í”„ë¡œì íŠ¸ ì…‹ì—…] ${title}`,
            description: fullDesc,
            type: 'feature',
            status: 'Backlog',
            assigneeAgentId: 'pm-01',
            priorityScore: 30
          })
        });
        closeModal('kickoffModal');
        alert('í”„ë¡œì íŠ¸ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. PM ì—ì´ì „íŠ¸ê°€ ì‘ì—…ì„ ë¶„í•´í•©ë‹ˆë‹¤.');
        load();
        runOrch(); // í‚¥ì˜¤í”„ í›„ ì¦‰ì‹œ ì‹¤í–‰
      } catch (err) {
        alert('í”„ë¡œì íŠ¸ ì ‘ìˆ˜ ì¤‘ ì˜¤ë¥˜: ' + err.message);
      }
    }

    /* â”€â”€â”€ Providers â”€â”€â”€ */
    const PROV_META = {
      'openai': { icon: 'AI', name: 'OpenAI', desc: 'GPT-4o / GPT-4o Mini', type: 'apikey', color: '#10a37f' },
      'gemini': { icon: 'G', name: 'Gemini (API Key)', desc: 'Gemini 2.0 Flash Â· API Key ë°©ì‹', type: 'apikey', color: '#4285f4' },
      'gemini-oauth': { icon: 'Gâ˜…', name: 'Gemini (Google OAuth)', desc: 'gcloud CLI ê¸°ë°˜ Google ê³„ì • ì—°ê²°', type: 'oauth', color: '#34a853' },
      'codex': { icon: 'CX', name: 'OpenAI Codex CLI', desc: 'codex auth login ê¸°ë°˜ OAuth', type: 'oauth', color: '#ff8a3d' },
      'github-copilot': { icon: 'GH', name: 'GitHub Copilot', desc: 'gh auth login ê¸°ë°˜ OAuth', type: 'oauth', color: '#24292e' },
    };

    async function loadProviders() {
      const statuses = await api('/api/providers');
      const map = Object.fromEntries(statuses.map(s => [s.provider, s]));
      document.getElementById('provList').innerHTML = Object.entries(PROV_META).map(([key, meta]) => {
        const st = map[key] || { configured: false, authMethod: 'none' };
        const authHtml = meta.type === 'apikey'
          ? `<div class="prov-body">
          <div class="row">
            <input class="inp" type="password" id="inp-${key}" placeholder="${meta.name} API í‚¤ ì…ë ¥">
            <button class="btn btn-primary" style="white-space:nowrap" onclick="saveApiKey('${key}')">ì €ì¥</button>
          </div>
          <div class="prov-test-row">
            <button class="btn btn-sm" onclick="testProv('${key}')">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
          </div>
        </div>`
          : `<div class="prov-body">
          ${meta.type === 'oauth' ? `
          <div class="prov-note">OAuth ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤. ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì‹œìŠ¤í…œì—ì„œ ì¸ì¦ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.</div>
          <div class="prov-test-row">
            <button class="btn btn-primary" onclick="startOAuth('${key}')">ğŸ”‘ ${meta.name} ì¸ì¦ ì‹œì‘</button>
            <button class="btn btn-sm" onclick="testProv('${key}')">ìƒíƒœ í™•ì¸</button>
          </div>` : ''}
        </div>`;
        return `<div class="prov-item">
      <div class="prov-head">
        <div class="prov-icon" style="color:${meta.color}">${meta.icon}</div>
        <div class="prov-info">
          <div class="prov-name">${meta.name}</div>
          <div class="prov-desc">${meta.desc}</div>
        </div>
        <span class="prov-badge ${st.configured ? 'ok' : 'no'}">${st.configured ? 'âœ“ ì—°ê²°ë¨' : 'ë¯¸ì—°ê²°'}</span>
      </div>
      ${authHtml}
    </div>`;
      }).join('');
    }

    async function saveApiKey(provider) {
      const val = document.getElementById(`inp-${provider}`).value.trim();
      if (!val) return alert('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      await api('/api/secrets', {
        method: 'POST',
        headers: { 'content-type': 'application/json' },
        body: JSON.stringify({ provider, keyName: 'api-key', value: val })
      });
      document.getElementById(`inp-${provider}`).value = '';
      await loadProviders();
      alert('âœ… ì €ì¥ ì™„ë£Œ! ì—°ê²° í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ ë³´ì„¸ìš”.');
    }

    async function startOAuth(name) {
      const r = await api(`/api/providers/${name}/auth-login`, { method: 'POST' });
      alert(r.started ? `âœ… ${r.reason}` : `âŒ ${r.reason}`);
      setTimeout(() => loadProviders(), 3000);
    }

    async function testProv(name) {
      const r = await api(`/api/providers/${name}/test`, { method: 'POST' });
      alert(`[${name.toUpperCase()}] ${r.connected ? 'âœ… ì—°ê²° ì„±ê³µ' : 'âŒ ì‹¤íŒ¨'}\n${r.reason}`);
      loadProviders();
    }

    /* â”€â”€â”€ Audit â”€â”€â”€ */
    async function loadAudit() {
      const logs = await api('/api/audit?limit=50');
      document.getElementById('auditEl').innerHTML = logs.map(a => `
    <div class="audit-item">
      <div class="audit-line"></div>
      <div style="flex:1">
        <div class="audit-action">${a.action} <span style="font-weight:400;color:var(--text-tertiary);font-size:13px">[${a.entity}]</span></div>
        <div class="audit-meta"><strong style="color:var(--brand)">${a.actor_agent_id || 'System'}</strong> â†’ ${a.entity_id}</div>
        ${a.reason ? `<div class="audit-reason">ì‚¬ìœ : ${escHtml(a.reason)}</div>` : ''}
        <div class="audit-time">${formatTime(a.created_at)}</div>
      </div>
    </div>
  `).join('') || '<div style="color:var(--text-tertiary)">ë¡œê·¸ ì—†ìŒ</div>';
    }

    /* â”€â”€â”€ Add Task â”€â”€â”€ */
    function showAddTask() { openModal('addTaskModal'); }
    async function submitTask() {
      const ac = (document.getElementById('taskAC').value || '').split('\n').map(s => s.trim()).filter(Boolean);
      await api('/api/tasks', {
        method: 'POST', headers: { 'content-type': 'application/json' },
        body: JSON.stringify({
          title: document.getElementById('taskTitle').value || 'ìƒˆ ì‘ì—…',
          description: document.getElementById('taskDesc').value,
          type: document.getElementById('taskType').value,
          urgency: Number(document.getElementById('taskUrgency').value),
          effort: Number(document.getElementById('taskEffort').value),
          priorityModel: 3, riskReduction: 3,
          acceptanceCriteria: ac
        })
      });
      closeModal('addTaskModal');
      load();
    }

    /* â”€â”€â”€ Orch â”€â”€â”€ */
    async function runOrch() { await api('/api/orchestrator/run', { method: 'POST' }); load(); }
    async function togglePause() { await api(`/api/control/orchestrator/${_paused ? 'resume' : 'pause'}`, { method: 'POST' }); load(); }

    /* â”€â”€â”€ Helpers â”€â”€â”€ */
    function openModal(id) { document.getElementById(id).classList.add('show'); }
    function closeModal(id) { document.getElementById(id).classList.remove('show'); }
    function escHtml(s) { const d = document.createElement('div'); d.textContent = s || ''; return d.innerHTML; }
    function formatTime(iso) { try { return new Date(iso).toLocaleString('ko-KR', { month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit', hour12: true }); } catch { return iso; } }

    setInterval(load, 8000);
    load();
  </script>
</body>

</html>